---
import { pricingTiers, pricingNotes } from '../data/pricing';

const appUrl = import.meta.env.PUBLIC_APP_URL || 'https://app.codescribeai.com';

// Replace production URLs with environment-aware URLs
const tiersWithEnvUrl = pricingTiers.map(tier => ({
  ...tier,
  ctaLink: tier.ctaLink.startsWith('mailto:')
    ? tier.ctaLink
    : tier.ctaLink.replace('https://app.codescribeai.com', appUrl)
}));
---

<section id="pricing" class="py-20 sm:py-24 bg-gradient-to-b from-slate-900 to-slate-950">
  <div class="max-w-7xl mx-auto px-6">
    <div class="text-center max-w-3xl mx-auto mb-16">
      <h2 class="text-4xl sm:text-5xl font-bold text-white mb-4">
        Simple, Transparent Pricing
      </h2>
      <p class="text-xl text-slate-300">
        Start free. Scale as you grow. Enterprise when you need it.
      </p>
    </div>

    <div class="grid md:grid-cols-4 gap-4 lg:gap-5">
      {tiersWithEnvUrl.map(tier => (
        <div class={`relative p-5 rounded-2xl transition-all duration-300 flex flex-col ${
          tier.highlight
            ? 'bg-slate-700/50 backdrop-blur-sm border-2 border-purple-500/50 shadow-lg hover:shadow-xl hover:-translate-y-1'
            : 'bg-slate-800/50 backdrop-blur-sm border border-slate-700 shadow-lg hover:shadow-2xl hover:shadow-slate-500/20 hover:border-slate-600 hover:-translate-y-1'
        }`}>
          {tier.highlight && (
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-1 bg-purple-500 text-white text-xs font-semibold rounded-full">
              MOST POPULAR
            </div>
          )}
          <div class="h-[160px]">
            <h3 class={`text-3xl font-bold mb-2 ${tier.highlight ? 'text-white' : 'text-white'}`}>
              {tier.name}
            </h3>
            <p class={`text-sm mb-4 ${tier.highlight ? 'text-purple-100' : 'text-slate-400'}`}>
              {tier.description}
            </p>
            <div class="mb-2">
              <span class={`text-4xl font-bold ${tier.highlight ? 'text-white' : 'text-white'}`}>
                {tier.price}
              </span>
              {tier.period && (
                <span class={`text-sm ${tier.highlight ? 'text-purple-100' : 'text-slate-400'}`}>
                  {tier.name === 'Enterprise' ? ' ' : '/'}{tier.period}
                </span>
              )}
            </div>
            {tier.annualPrice && (
              <p class={`text-sm font-medium ${
                tier.highlight ? 'text-purple-100' : 'text-slate-400'
              }`}>
                {tier.annualTotal} <span class="text-emerald-400">({tier.savings?.toLowerCase() || 'save'})</span>
              </p>
            )}
          </div>
          <a
            href={tier.ctaLink}
            class="block w-full text-center py-3 px-4 rounded-xl font-semibold transition-all duration-200 mb-6 bg-slate-700 text-white hover:bg-slate-600 border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg"
          >
            {tier.cta}
          </a>
          <ul class="space-y-3">
            {tier.features.map(feature => {
              const hasNew = feature.includes('✨');
              const hasComingSoon = feature.includes('¹');
              const hasCompliance = feature.includes('²');
              const cleanFeature = feature.replace('✨', '').replace('¹', '').replace('²', '');

              return (
                <li class="flex items-start gap-2">
                  <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                  <span class={`text-sm ${tier.highlight ? 'text-white' : 'text-slate-300'}`}>
                    {cleanFeature}
                    {hasNew && (
                      <span class="ml-1 text-[11px] font-semibold text-amber-400 uppercase">
                        new✨
                      </span>
                    )}
                    {hasComingSoon && (
                      <span class="ml-0.5 text-slate-500 text-xs relative -top-0.5">¹</span>
                    )}
                    {hasCompliance && (
                      <span class="ml-0.5 text-purple-400 text-xs relative -top-0.5">²</span>
                    )}
                  </span>
                </li>
              );
            })}
          </ul>
        </div>
      ))}
    </div>

    <!-- Pricing Notes -->
    <div class="mt-12 max-w-4xl mx-auto space-y-6">
      <!-- All Tiers Include -->
      <div class="flex justify-center">
        <div class="inline-flex items-center gap-2 px-6 py-3 bg-slate-800/50 border border-slate-700 rounded-xl">
          <svg class="w-5 h-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
          <p class="text-sm text-slate-300">
            All tiers include: <span class="font-semibold text-slate-200">{pricingNotes.allTiersInclude}</span>
          </p>
        </div>
      </div>

      <!-- Security Badge -->
      <div class="flex justify-center">
        <div class="inline-flex items-center gap-2 px-6 py-3 bg-slate-800/50 border border-slate-700 rounded-xl">
          <svg class="w-5 h-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
          <p class="text-sm text-slate-300">
            {pricingNotes.dataPrivacy}
          </p>
        </div>
      </div>

      <!-- Footnotes -->
      <div class="text-center space-y-2">
        <p class="text-sm text-slate-500 italic">
          {pricingNotes.comingSoon}
        </p>
        <p class="text-sm text-slate-500">
          {pricingNotes.compliance}
        </p>
      </div>
    </div>
  </div>
</section>
